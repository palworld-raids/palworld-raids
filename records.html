<style>
.dt-container { container-type: inline-size; }

table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;

  td, th {
    padding: 8px;
    @container (width < 748px) { 
      text-align: left !important;
      &:before { 
        font-weight: 700; 
      } 
    }
  }
  
  tr:nth-child(even) {
    background-color: #1112;
  }

  th {
    font-weight: 600;
  }

  [data-player] {
    &:is(th) {}
    &:is(td) {
      @container (width < 748px) {
        grid-area: player;
        &:before { content: 'Player: ' }
      }
    }
  }
  [data-game-version] {
    text-align: right !important;
    &:is(th) {}
    &:is(td) {
      @container (width < 748px) {
        text-align: left !important;
        grid-area: game-version;
        &:before { content: 'Version: ' }
      }
    }
  }
  [data-raid] {
    &:is(th) {}
    &:is(td) {
      a { text-decoration: underline #FFFFFF; }
      img {
        aspect-ratio: 1;
        width: 1.2em;
        vertical-align: bottom;
      }
      @container (width < 748px) {
        grid-area: raid;
        &:before { content: 'Raid: ' }
      }
    }
  }
  [data-pals] {
    &:is(th) {}
    &:is(td) {
      @container (width < 748px) {
        grid-area: pals;
        &:before { content: 'Pals: ' }
      }
    }
  }
  [data-strategy] {
    &:is(th) {}
    &:is(td) {
      @container (width < 748px) {
        grid-area: strategy;
        &:before { content: 'Strategy: ' }
      }
      span {
        border-radius: 12px;
        border: 1px solid #495057;
        background-color: #495057AA;
        padding: 0.25em 0.5em;
        white-space: nowrap;
      }
    }
  }
  [data-timer] {
    text-align: center !important;
    &:is(th) {}
    &:is(td) {
      @container (width < 748px) {
        text-align: left !important;
        grid-area: timer;
        &:before { content: 'Timer: ' }
      }
    }
  }
  [data-submit-date] {
    text-align: right !important;
    &:is(th) {}
    &:is(td) {
      @container (width < 748px) {
        text-align: left !important;
        grid-area: submit-date;
        &:before { content: 'Submit date: ' }
      }
    }
  }
  [data-review-date] {
    text-align: right !important;
    &:is(th) {}
    &:is(td) {
      @container (width < 748px) {
        text-align: left !important;
        grid-area: review-date;
        &:before { content: 'Review date: ' }
      }
    }
  }

  tfoot {
    font-size: 0.6em;
    color: #8888;
    td { text-align: right !important; }
  }

  @container (width < 748px) { 
    &, tbody, td {
      display: block; 
    }
    td {
      padding: 0.125em 0.5em;
    }
    tbody tr {
      background-color: #1112;
      border: 1px solid white;
      display: grid;
      margin-block: 1.5em;
      grid-template-columns: repeat(4, 1fr);
      grid-template-areas: 
        "player player raid raid"
        "pals pals timer timer"
        "strategy strategy strategy strategy"
        "game-version game-version game-version game-version"
        "submit-date submit-date review-date review-date" 
      ;
    }
    thead, th { 
      display: none; 
    }
  }
}


</style>
<table id="myTable">
    <thead>
        <tr>                         
            <th data-player>Player</th>
            <th data-game-version>Version</th>
            <th data-raid>Boss</th>
            <th data-pals>Pals</th>
            <th data-strategy>Strategy type</th>
            <th data-timer>Timer</th>
            <th data-submit-date>Submit date</th>
            <th data-review-date>Review date</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td data-player>Raids</td>
        <td data-game-version>0.6.2</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=nq13UEkJ8xU" target="_blank" noreferrer>Xenolord Ultra</a></td>
        <td data-pals>Ghangler Ignis (15)</td>
        <td data-strategy>
            <span>Player Damage</span>
        </td>
        <td data-timer>0:02:41</td>
        <td data-submit-date>9/17/2025 12:33:26</td>
        <td data-review-date>9/17/2025 12:39:03</td>
    </tr>
    <tr>
        <td data-player>Pedia</td>
        <td data-game-version>0.6.4</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=5krfHRl2hOQ" target="_blank" noreferrer>Moon Lord Master</a></td>
        <td data-pals>49 Bellanoir Libero and 1 Orserk (50)</td>
        <td data-strategy>
            <span>Glitches or Exploits</span>
        </td>
        <td data-timer>0:00:19</td>
        <td data-submit-date>9/17/2025 12:34:02</td>
        <td data-review-date>9/17/2025 12:39:03</td>
    </tr>
    <tr>
        <td data-player>Raids</td>
        <td data-game-version>0.6.5</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=1jBNa5t3wS8" target="_blank" noreferrer>Moon Lord Master</a></td>
        <td data-pals>Frostallion Noct (15)</td>
        <td data-strategy>
            <span>Pal Pods or Rescue Pals</span>
        </td>
        <td data-timer>0:01:30</td>
        <td data-submit-date>9/18/2025 9:44:50</td>
        <td data-review-date>9/18/2025 19:12:00</td>
    </tr>
    <tr>
        <td data-player>Kazoorion</td>
        <td data-game-version>0.6.6</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=vgR2cixUjk0" target="_blank" noreferrer>Blazamut Ryu Ultra</a></td>
        <td data-pals>Neptilius (15)</td>
        <td data-strategy>
        </td>
        <td data-timer>0:02:45</td>
        <td data-submit-date>9/18/2025 22:32:34</td>
        <td data-review-date>9/19/2025 13:07:23</td>
    </tr>
    <tr>
        <td data-player>Raids</td>
        <td data-game-version>0.6.6</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=_-5R7b1p4J4" target="_blank" noreferrer>Xenolord Ultra</a></td>
        <td data-pals>Zoe (15)</td>
        <td data-strategy>
        </td>
        <td data-timer>0:04:31</td>
        <td data-submit-date>9/19/2025 10:35:14</td>
        <td data-review-date>9/19/2025 13:07:23</td>
    </tr>
    <tr>
        <td data-player>Raids</td>
        <td data-game-version>0.6.6</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=O6s6huNpQW0" target="_blank" noreferrer>Moon Lord Master</a></td>
        <td data-pals>Zoe (15)</td>
        <td data-strategy>
        </td>
        <td data-timer>0:02:44</td>
        <td data-submit-date>9/19/2025 10:35:54</td>
        <td data-review-date>9/19/2025 13:07:23</td>
    </tr>
    <tr>
        <td data-player>Raids</td>
        <td data-game-version>0.6.5</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=b7ILebsFjxY" target="_blank" noreferrer>Xenolord Ultra</a></td>
        <td data-pals>Neptilius (15)</td>
        <td data-strategy>
            <span>Glitches or Exploits</span>
            <span>Player Damage</span>
        </td>
        <td data-timer>0:01:02</td>
        <td data-submit-date>9/20/2025 12:26:20</td>
        <td data-review-date>9/23/2025 13:04:21</td>
    </tr>
    <tr>
        <td data-player>Handyboots</td>
        <td data-game-version>0.5.1</td>
        <td data-raid><a href="http://www.youtube.com/watch?v=m1PT_K6G3SM" target="_blank" noreferrer>Blazamut Ryu Ultra</a></td>
        <td data-pals>Dumud (15)</td>
        <td data-strategy>
            <span>Pal Pods or Rescue Pals</span>
        </td>
        <td data-timer>0:03:48</td>
        <td data-submit-date>9/23/2025 19:59:38</td>
        <td data-review-date>9/26/2025 9:08:26</td>
    </tr>
    <tr>
        <td data-player>Handyboots</td>
        <td data-game-version>0.5.2</td>
        <td data-raid><a href="http://www.youtube.com/watch?v=eNUYELfWgHg&t=1s" target="_blank" noreferrer>Xenolord</a></td>
        <td data-pals>Pengullet (15)</td>
        <td data-strategy>
            <span>Pal Pods or Rescue Pals</span>
        </td>
        <td data-timer>0:04:58</td>
        <td data-submit-date>9/23/2025 20:22:20</td>
        <td data-review-date>9/26/2025 9:08:26</td>
    </tr>
    <tr>
        <td data-player>Handyboots</td>
        <td data-game-version>0.5.5</td>
        <td data-raid><a href="http://www.youtube.com/watch?v=zBLkq4jUuj0&t=1s" target="_blank" noreferrer>Xenolord</a></td>
        <td data-pals>Chillet (15)</td>
        <td data-strategy>
            <span>Glitches or Exploits</span>
            <span>Pal Pods or Rescue Pals</span>
        </td>
        <td data-timer>0:04:10</td>
        <td data-submit-date>9/23/2025 20:23:14</td>
        <td data-review-date>9/26/2025 9:08:26</td>
    </tr>
    <tr>
        <td data-player>Handyboots</td>
        <td data-game-version>0.6.6</td>
        <td data-raid><a href="http://www.youtube.com/watch?v=jdCUvbQSxjU&t=4s" target="_blank" noreferrer>Xenolord Ultra</a></td>
        <td data-pals>Polapup (15)</td>
        <td data-strategy>
            <span>Glitches or Exploits</span>
            <span>Pal Pods or Rescue Pals</span>
        </td>
        <td data-timer>0:04:53</td>
        <td data-submit-date>9/23/2025 20:23:57</td>
        <td data-review-date>9/26/2025 9:08:26</td>
    </tr>
    <tr>
        <td data-player>Raids</td>
        <td data-game-version>0.6.5</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=mLjKoMRs8zI" target="_blank" noreferrer>Bjorn & Bastigor (Hard)</a></td>
        <td data-pals>Shadowbeak (5)</td>
        <td data-strategy>
        </td>
        <td data-timer>0:01:33</td>
        <td data-submit-date>9/28/2025 12:39:51</td>
        <td data-review-date>9/29/2025 16:05:19</td>
    </tr>
    <tr>
        <td data-player>Raids</td>
        <td data-game-version>0.6.1</td>
        <td data-raid><a href="https://www.youtube.com/watch?v=bDS9ggk4oBw" target="_blank" noreferrer>Bjorn & Bastigor (Hard)</a></td>
        <td data-pals>Turtacle Terra (5)</td>
        <td data-strategy>
        </td>
        <td data-timer>0:01:48</td>
        <td data-submit-date>9/28/2025 18:45:59</td>
        <td data-review-date>9/29/2025 16:05:19</td>
    </tr>
    <tr>
        <td data-player>Handyboots</td>
        <td data-game-version>0.6.7</td>
        <td data-raid><a href="http://www.youtube.com/watch?v=RXEWt8FlxZs" target="_blank" noreferrer>Xenolord Ultra</a></td>
        <td data-pals>Lamball, Cattiva, Chikipi, Lifmunk, Foxparks, Fuack, Sparkit, Tanzee, Rooby, Pengullet, Jolthog, Gumoss, Vixy (all Alphas) and 2 rescue Neptilius (15)</td>
        <td data-strategy>
            <span>Pal Pods or Rescue Pals</span>
            <span>Glitches or Exploits</span>
            <span>Alpha only</span>
        </td>
        <td data-timer>0:05:50</td>
        <td data-submit-date>10/7/2025 20:10:20</td>
        <td data-review-date>10/8/2025 11:22:49</td>
    </tr>
    <tr>
        <td data-player>Handyboots</td>
        <td data-game-version>0.6.7</td>
        <td data-raid><a href="http://youtu.be/6qQoyZ4_6zA" target="_blank" noreferrer>Xenolord Ultra</a></td>
        <td data-pals>Elizabee (3), Beegarde (10), Neptilius (2 for rescue) (15)</td>
        <td data-strategy>
            <span>Pal Pods or Rescue Pals</span>
            <span>Glitches or Exploits</span>
        </td>
        <td data-timer>0:05:08</td>
        <td data-submit-date>10/18/2025 3:45:22</td>
        <td data-review-date>12/17/2025 12:25:24</td>
    </tr>
    <tr>
        <td data-player>Consisent Payment</td>
        <td data-game-version>0.6.8</td>
        <td data-raid><a href="https://www.reddit.com/r/Palworld/comments/1pcgjqq/perfect_elphidran_aqua_vs_hard_mode_zoe/" target="_blank" noreferrer>Zoe & Grizzbolt (Hard)</a></td>
        <td data-pals>1 Elphidran Aqua, 2 Kelpseas and 2 Gobfins (5)</td>
        <td data-strategy>
        </td>
        <td data-timer>0:01:48</td>
        <td data-submit-date>12/3/2025 9:48:04</td>
        <td data-review-date>12/17/2025 12:25:24</td>
    </tr>
    <tr>
        <td data-player>Consisent Payment</td>
        <td data-game-version>0.6.8</td>
        <td data-raid><a href="https://www.reddit.com/r/Palworld/comments/1pexlbz/bored_so_i_tried_beating_bellanoir_libero_solo/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button" target="_blank" noreferrer>Bellanoir Libero</a></td>
        <td data-pals>1 Felbat and 4 Gobfins (5)</td>
        <td data-strategy>
            <span>Player Damage</span>
        </td>
        <td data-timer>0:03:07</td>
        <td data-submit-date>12/5/2025 14:13:29</td>
        <td data-review-date>12/17/2025 12:25:24</td>
    </tr>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="8">Last publishing date: 2025-12-17T19:10:45.052637</td>
        </tr>
    </tfoot>
</table>

<script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/2.3.4/css/dataTables.dataTables.css" />
<script src="https://cdn.datatables.net/2.3.4/js/dataTables.js"></script>


<link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.2.5/css/buttons.dataTables.min.css"/>
<script src="https://cdn.datatables.net/buttons/3.2.5/js/dataTables.buttons.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/datetime/1.6.0/css/dataTables.dateTime.min.css"/>
<script src="https://cdn.datatables.net/datetime/1.6.0/js/dataTables.dateTime.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/rowgroup/1.6.0/css/rowGroup.dataTables.min.css"/>
<script src="https://cdn.datatables.net/rowgroup/1.6.0/js/dataTables.rowGroup.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/searchbuilder/1.8.4/css/searchBuilder.dataTables.min.css"/>
<script src="https://cdn.datatables.net/searchbuilder/1.8.4/js/dataTables.searchBuilder.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/2.3.5/css/searchPanes.dataTables.min.css"/>
<script src="https://cdn.datatables.net/searchpanes/2.3.5/js/dataTables.searchPanes.min.js"></script>

<script>
const filterDataValues = {
  strats: getTags(data, 'strategy'),
  bossList: [
    "Bellanoir",
    "Bellanoir Libero",
    "Bellanoir Libero Ultra",
    "Blazamut Ryu",
    "Blazamut Ryu Ultra",
    "Xenolord",
    "Xenolord Ultra",
    "Moon Lord",
    "Moon Lord Master",
  ],
  towerList: [
    "Zoe & Grizzbolt (Hard)",
    "Lily & Lyleen (Hard)",
    "Axel & Orserk (Hard)",
    "Marcus & Faleris (Hard)",
    "Victor & Shadowbeak (Hard)",
    "Saya & Selyne (Hard)",
    "Bjorn & Bastigor (Hard)",
  ]
}

function getTags(data, attr) {
  return new Set(data.map(entry => entry[attr]).flat().filter(v => !!v))
}

const filterBoss = (boss) => {
  const sbprev = table.searchBuilder.getDetails()
  const prevCriterias = sbprev?.criteria?.filter(c => !(c.data === "Boss" && c.condition === "is")) ?? []
  const sbValue = {
    logic: "AND",
    criteria: [
      ...prevCriterias.map(c=>({ ...c, origData: "button" })),
      {
        condition: "is",
        origData: "button", // This attribute is required to validate the entry (see "sbObj.s.origData" in isInputValid)
        data: "Boss",
        type: "boss",
        value: [ boss ]
      }
    ]
  }
  table.searchBuilder.rebuild(sbValue)
}

//table.columns(1).search((val, row, index, col) => val === boss).draw()
/**
   * An other way consists of rebiulding the searchBuilder with a predefined search but it doesn't work well
  ```
  table.searchBuilder.rebuild({
    "logic": "AND",
    "criteria": [
      {
        "condition": "=",
        "data": "Boss",
        "type": "string",
        "value": [
          boss
        ]
      }
    ]
  }) 
  ```
*/

createGroupingFn = (column) => () => table.order([{ name: column, dir: 'asc'}]).rowGroup().dataSrc(column).rowGroup().enable().draw()
createSortingFn = (column) => () => table.order([{ name: column, dir: 'asc'}])


const viewList = [
  { label: "Group by player", fn: createGroupingFn("player") },
  { label: "Group by bosses", fn: createGroupingFn("boss") },
  { label: "Group by version", fn: createGroupingFn("game_version") },
]

/** ordering
 * timer
 * version
 * date
 */

function unspanData(data) {
  const regex = /(<span>(\w+(\s+\w+)*)<\/span>)+/g;
  const dataArray = []
  while ((m = regex.exec(data.replace('\n',''))) !== null) {
    if (m.index === regex.lastIndex) {
      regex.lastIndex++;
    }
    dataArray.push(m[2])
  }
  return dataArray
}
function respanData(data) {
  return data.map(strat => `<span>${strat}</span>`).join('')
}
function createOptionFilter(data) {
  const el = $('<select/>') //document.createElement('select');
  el.addClass("dtsb-value")
    .addClass("dtsb-dropDown")
    .addClass("dtsb-select")
  data.forEach(strat => {
    const stratOption = $('<option/>').val(strat).text(strat) //document.createElement('option')
    //stratOption.value = strat
    //stratOption.text = strat
    el.append(stratOption)
  })
  return el
}

function optionFilterInit(data) {
  return (that, fn, preDefined = null) => {
    const el = createOptionFilter(data)
      .on('input', () => fn(that, this)).val(null);
    //el.addEventListener('input', () => fn(that, this));
    $(el).val('')
    return el;
  }
}


function getImageUrl(raidName) {
  if (raidName === 'Bellanoir')
    return "https://images.squarespace-cdn.com/content/68bd6b47bbd3f202164db779/25c049ed-502e-4bce-9107-49d3e30745ea/bellanoir.webp?content-type=image%2Fwebp"
  if (raidName.startsWith('Bellanoir Libero'))
    return "https://images.squarespace-cdn.com/content/68bd6b47bbd3f202164db779/4b9f2ec1-e369-4a3c-8fcb-8e26a72cf3c0/libero.webp?content-type=image%2Fwebp"
  if (raidName.startsWith('Blazamut Ryu'))
    return "https://images.squarespace-cdn.com/content/68bd6b47bbd3f202164db779/eef5663d-5524-4166-bfae-b974d5137c1c/T_KingBahamut_Dragon_icon_normal.webp?content-type=image%2Fwebp"
  if (raidName.startsWith("Xenolord"))
    return "https://images.squarespace-cdn.com/content/68bd6b47bbd3f202164db779/fa711866-1e06-492e-81eb-b1660151bd03/T_DarkMechaDragon_icon_normal.webp?content-type=image%2Fwebp"
  if (raidName.startsWith('Moon Lord'))
    return "https://images.squarespace-cdn.com/content/68bd6b47bbd3f202164db779/1b59726a-ba71-49a8-b4ff-80c3dbf76f2c/moonlord.png?content-type=image%2Fpng"
  if (raidName.startsWith('Hartalis'))
    return "https://palworld-raids.github.io/palworld-raids/static/img/pals/T_LegendDeer_icon_normal.webp" // TODO: Replace this GH url by SQS CDN URL

  if (raidName.startsWith("Zoe & Grizzbolt"))
    return "https://palworld-raids.github.io/palworld-raids/static/img/tower/banner/T_map_boss_banner_0.webp" // TODO: Replace this GH url by SQS CDN URL
  if (raidName.startsWith("Lily & Lyleen"))
    return "https://palworld-raids.github.io/palworld-raids/static/img/tower/banner/T_map_boss_banner_1.webp" // TODO: Replace this GH url by SQS CDN URL
  if (raidName.startsWith("Axel & Orserk"))
    return "https://palworld-raids.github.io/palworld-raids/static/img/tower/banner/T_map_boss_banner_2.webp" // TODO: Replace this GH url by SQS CDN URL
  if (raidName.startsWith("Marcus & Faleris"))
    return "https://palworld-raids.github.io/palworld-raids/static/img/tower/banner/T_map_boss_banner_3.webp" // TODO: Replace this GH url by SQS CDN URL
  if (raidName.startsWith("Victor & Shadowbeak"))
    return "https://palworld-raids.github.io/palworld-raids/static/img/tower/banner/T_map_boss_banner_4.webp" // TODO: Replace this GH url by SQS CDN URL
  if (raidName.startsWith("Saya & Selyne"))
    return "https://palworld-raids.github.io/palworld-raids/static/img/tower/banner/T_map_boss_banner_5.webp" // TODO: Replace this GH url by SQS CDN URL
  if (raidName.startsWith("Bjorn & Bastigor"))
    return "https://palworld-raids.github.io/palworld-raids/static/img/tower/banner/T_map_boss_banner_6.webp" // TODO: Replace this GH url by SQS CDN URL
  
  return undefined
}

function buildRaidLink(raid, videoLink) {
  const imgUrl = getImageUrl(raid)
  const link = document.createElement('a')
  const textSpan = document.createElement('span')
  
  link.href = videoLink
  textSpan.innerText = raid

  /* 
  TO BE IMPLEMENTED
  if (imgUrl) {
    const img = document.createElement('img')
    img.src = imgUrl
    link.appendChild(img)
  } 
  */

  link.appendChild(textSpan)
  
  return link
}

function createDepictedFilterButton(boss) {
  const bossOptionButton = document.createElement('button')
  bossOptionButton.setAttribute('data-value', boss)
  // Image
  const img = document.createElement('img')
  img.src = getImageUrl(boss)
  // Text
  const text = document.createElement('span')
  text.innerText = boss
  bossOptionButton.appendChild(img)
  bossOptionButton.appendChild(text)
  bossOptionButton.addEventListener('click', () => filterBoss(boss))
  return bossOptionButton
}

function createCustomFilters() {
  const customFiltersContainer = document.createElement('dialog')
  customFiltersContainer.id = 'filter-dialog'
  customFiltersContainer.setAttribute("closedby", "any")

  const selectBossButtonGroup = document.createElement("section")
  selectBossButtonGroup.setAttribute("data-filter", "boss")
  const selectBossButtonGroupSummary = document.createElement('div')
  selectBossButtonGroupSummary.innerText = 'Raid bosses'
  selectBossButtonGroup.appendChild(selectBossButtonGroupSummary)

  const selectTowerButtonGroup = document.createElement("section")
  selectTowerButtonGroup.setAttribute("data-filter", "tower")
  const selectTowerButtonGroupSummary = document.createElement('div')
  selectTowerButtonGroupSummary.innerText = 'Tower bosses'
  selectTowerButtonGroup.appendChild(selectTowerButtonGroupSummary)

  filterDataValues.bossList.forEach(boss => selectBossButtonGroup.appendChild(createDepictedFilterButton(boss)))
  filterDataValues.towerList.forEach(boss => selectTowerButtonGroup.appendChild(createDepictedFilterButton(boss)))

  customFiltersContainer.appendChild(selectBossButtonGroup)
  customFiltersContainer.appendChild(selectTowerButtonGroup)

  return customFiltersContainer
}

function createSearchBuilderContainer() {
  const customFiltersContainer = document.createElement('dialog')
  customFiltersContainer.id = "search-dialog"
  customFiltersContainer.setAttribute("closedby", "any")
  customFiltersContainer.setAttribute("data-filter", "custom")
  return customFiltersContainer
}

document.body.appendChild(createCustomFilters())
document.body.appendChild(createSearchBuilderContainer())

let table = new DataTable('#records', {
  data: data,
  //rowGroup: { dataSrc: 'raid' },
  columns: [
    {
      target: 0,
      data: "player",
      title: "Player",
      className: "records--player",
    },
    {
      target: 1,
      data: "raid",
      title: "Boss",
      type: 'boss',
      className: "records--raid",
      data: function (row, type, val, meta) {
        switch (type) {
          case 'display':
            return buildRaidLink(row.raid, row.video_link)
          default: // 'filter','set','sort','type',
            console.log(`Table: "${type}" data for row: ${row.raid}`, row, val, meta)
            return row.raid
        }
      }
    },
    {
      target: 2,
      data: "pals",
      title: "Pals",
      className: "records--pals",
    },
    {
      target: 3,
      type: 'strategy',
      title: "Strategy type",
      data: function (row, type, val, meta) {
          switch (type) {
            case 'display':
              return respanData(row.strategy)
            default: // 'filter','set','sort','type',
              break;
          }
          //console.log(`Table: "${type}" data for row: ${row.strat}`, row, val, meta)
          return row.strategy
        },
      className: "records--strategy",
    },
    {
      target: 4,
      data: "timer",
      //type: 'timer',
      title: "Timer",
      data: function (row, type, val, meta) {
          switch (type) {
            case 'display':
              return row.timer.slice(2)
            default: // 'filter','set','sort','type',
              break;
          }
          //console.log(`Table: "${type}" data for row: ${row.strat}`, row, val, meta)
          return row.strategy
        },
      className: "records--timer dt-type-numeric",
    },
    {
      target: 5,
      data: "game_version",
      title: "Version",
      className: "records--game-version dt-type-numeric",
    },
    {
      target: 6,
      data: "submit_date",
      type: 'date',
      title: "Submit date",
      className: "records--submit-date",
    },
    {
      target: 7,
      data: "review_date",
      type: 'date',
      title: "Review date",
      className: "records--review-date",
    }
  ],
  layout: {
    topStart: null,
    topEnd: null,
    top: [ 
      { 
        buttons: [    
          {
            text: "Predefined filters",
            action: () => document.getElementById("filter-dialog").showModal()
          },
          {
            text: "Custom filters",
            action: () => document.getElementById("search-dialog").showModal()
          }
        ] 
      }, 
      { search: { text: '', placeholder: 'Search' } }, 
      "paging"
    ],
    bottomStart: "pageLength",
    bottomEnd: "paging",
  },
});

const validateInputEnum = (el, sbObj) => {
  const value = $(el[0]).val()
  console.log(sbObj)
 
  if (sbObj.s.origData === "button") {
    $(el[0]).val(sbObj.s.value[0])
    return true
  } 
  
  if (!value)
    return false

  return value.length !== 0; 
}
const validateInputEnumInData = (el, sbObj) => {
  const value = $(el[0]).val()
  
  if (sbObj.s.reset > 1) {
    sbObj.s.origData = undefined
    sbObj.s.reset = 0
  }
  
  if (sbObj.s.origData === "button") { 
    // This is used to set the input value when the entry uses rebuild() feature
    $(el[0]).val(sbObj.s.value[0])
    if (sbObj.s.reset > 0)
      sbObj.s.reset++
    else
      sbObj.s.reset = 1
    return true
  }

  if (!value)
    return false

  return filterDataValues.bossList.includes(value) || filterDataValues.towerList.includes(value); 
}

new DataTable.Buttons(table, {
  buttons: [
    {
      extend: 'searchBuilder',
      config: {
        //columns: [0, 1, 2, 3, 4],
        conditions: {
          strategy: {
            contains: {
              conditionName: 'Contains', // String value that will be displayed in the condition select element
              init: optionFilterInit(filterDataValues.strats),
              inputValue: function (el) { return $(el[0]).val(); },
              isInputValid: validateInputEnum,
              search: function (value, comparison) { return value.includes(comparison) }
            },
            doesNotContain: {
              conditionName: 'Does not contain', // String value that will be displayed in the condition select element
              init: optionFilterInit(filterDataValues.strats),
              inputValue: function (el) { return $(el[0]).val(); },
              isInputValid: validateInputEnum,
              search: function (value, comparison) { return !value.includes(comparison) }
            },
            is: {
              conditionName: 'Is', // String value that will be displayed in the condition select element
              init: function (that, fn, preDefined = null) {
                var el = document.createElement('select');
                ["Empty", "Not empty"].forEach(value => {
                  const filterOption = document.createElement('option')
                  filterOption.value = value
                  filterOption.text = value
                  el.appendChild(filterOption)
                });
                el.value = '';
                el.addEventListener('input', () => fn(that, this));
                return el
              },
              inputValue: function (el) { 
                return $(el[0]).val(); 
              },
              isInputValid: validateInputEnum,
              search: function (value, comparison) { 
                console.log("Comparing ", value, comparison)
                return comparison.includes('Empty') ? !value.length : comparison.includes('Not empty') ? !!value.length : true }
            }
          },
          boss: {
            is: {
              conditionName: 'Is', // String value that will be displayed in the condition select element
              init: optionFilterInit([filterDataValues.bossList, filterDataValues.towerList].flat()),
              inputValue: function (el) { return $(el[0]).val(); },
              isInputValid: validateInputEnumInData,
              search: function (value, comparison) { return value === comparison[0] }
            },
            isNot: {
              conditionName: 'Is not', // String value that will be displayed in the condition select element
              init: optionFilterInit([filterDataValues.bossList, filterDataValues.towerList].flat()),
              inputValue: function (el) { return $(el[0]).val(); },
              isInputValid: validateInputEnumInData,
              search: function (value, comparison) { return !value === comparison[0] }
            },
          }
        }
      }
    },
    {
      text: "Predefined filters",
      action: () => console.log("predefil")
    }
  ]
});

table.searchBuilder.container().appendTo('#search-dialog')

</script>